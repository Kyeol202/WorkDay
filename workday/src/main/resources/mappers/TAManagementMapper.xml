<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="TAManagement">
  
  <insert id="insertGto" parameterType="TAManagement">
  	
INSERT INTO TA_MANAGEMENT(
    TA_ID,
    U_ID,
    GTO,
    STATUS
)
values(
    TA_MANAGEMENT_SEQ.NEXTVAL,
    #{u_id},
    TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI'),
    default
    )
  
  </insert>
  
  	<sql id="pagingHeader">
  SELECT * FROM (
  SELECT ROWNUM AS rn, A.* FROM (
  </sql>
  
  <sql id="pagingFooter">
  )A
  )WHERE rn BETWEEN #{start} AND #{end}
  </sql>
  
  <sql id="search">
  <choose>
 <when test="searchSort !=''">
 AND ${searchSort} LIKE '%' || #{searchVal} || '%'
 </when> 
  </choose>
  </sql>
  
  <select id="selectGtoAllList" resultType="JoinDto" parameterType="com.bno.dto.BoardPager">
  <include refid="pagingHeader"></include>
  	SELECT U.U_NAME, U.DP_NAME, U.U_POSITION, T.GTO, T.STATUS
	FROM USER_INFO U
	JOIN TA_MANAGEMENT T
	ON U.U_ID = T.U_ID
  	WHERE 1 =1
  	<include refid="search"></include>
  	ORDER BY T.GTO
  	<include refid="pagingFooter"></include>
  </select>
  
  <select id="selectuserGtoCount" parameterType="searchDto" resultType="int">
  	SELECT COUNT(*)
  	FROM (
  	SELECT U.U_NAME, U.DP_NAME, U.U_POSITION, T.GTO, T.STATUS
	FROM USER_INFO U
	JOIN TA_MANAGEMENT T
	ON U.U_ID = T.U_ID )
  	WHERE 1 =1
  	
  <include refid="search"></include>
  </select>
  
  <update id="owUpdate" parameterType="TAManagement">
  UPDATE TA_MANAGEMENT
  SET OW = T_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI)
  WHERE TA_ID = #{ta_id} AND STATUS = 'Y'
  </update>
  
  <select id="selectOwAllList" resultType="JoinDto" parameterType="com.bno.dto.BoardPager">
	   <include refid="pagingHeader"></include>
  	SELECT U.U_NAME, U.DP_NAME, U.U_POSITION, T.OW, T.WORKINGHOUR, T.STATUS
	FROM USER_INFO U
	JOIN TA_MANAGEMENT T
	ON U.U_ID = T.U_ID
  	WHERE 1 =1
  		<include refid="search"></include>
  	ORDER BY T.OW
  		<include refid="pagingFooter"></include>
  
  </select>
  
  
  <select id="selectuserOwCount" parameterType="searchDto" resultType="int">
  	SELECT COUNT(*)
  	FROM (
  	SELECT U.U_NAME, U.DP_NAME, U.U_POSITION, T.OW, T.WORKINGHOUR, T.STATUS
	FROM USER_INFO U
	JOIN TA_MANAGEMENT T
	ON U.U_ID = T.U_ID )
  	WHERE 1 =1
  	
  <include refid="search"></include>
  </select>
  
  </mapper>